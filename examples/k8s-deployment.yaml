# Example Kubernetes Deployment for an MCP server using mcp-secrets.
#
# Prerequisites:
#   1. Generate the K8s secret:
#      mcp-secrets k8s --namespace default --secret-name mcp-server-keys | kubectl apply -f -
#   2. Clean local keys:
#      mcp-secrets clean
#   3. Build and push your container image.
#   4. Apply this file:
#      kubectl apply -f k8s-deployment.yaml

apiVersion: apps/v1
kind: Deployment
metadata:
  name: mcp-server
spec:
  replicas: 1
  selector:
    matchLabels:
      app: mcp-server
  template:
    metadata:
      labels:
        app: mcp-server
    spec:
      automountServiceAccountToken: false
      containers:
      - name: mcp-server
        image: your-registry/mcp-server:latest
        ports:
          - containerPort: 8000
        volumeMounts:
          - mountPath: /etc/mcp/secrets
            name: mcp-secret-volume
            readOnly: true
        env:
          - name: MCP_KEY_FILE_PATH
            value: "/etc/mcp/secrets/key.pem"
      volumes:
      - name: mcp-secret-volume
        secret:
          secretName: mcp-server-keys
          defaultMode: 0400
          items:
            - key: mcp_jwks
              path: key.pem
---
apiVersion: v1
kind: Service
metadata:
  name: mcp-server
spec:
  selector:
    app: mcp-server
  ports:
    - protocol: TCP
      port: 8000
      targetPort: 8000
  type: ClusterIP
